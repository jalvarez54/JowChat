$(function(){CDF54.JA.SIGNALR.CHAT.APP.Init();CDF54.JA.SIGNALR.CHAT.APP.Start()});CDF54.JA.SIGNALR.CHAT.APP=function(){"use strict";function n(){var t=window.location.pathname,n=window.location.pathname.split("/");return n[n.length-1]}function t(){CDF54.JA.SIGNALR.CHAT.MISC.registerClientMethods();CDF54.JA.SIGNALR.CHAT.USER.registerClientMethods();CDF54.JA.SIGNALR.CHAT.MESSAGE.registerClientMethods();aliasPRIVATE.registerClientMethods();aliasPUBLIC.registerClientMethods();CDF54.JA.SIGNALR.CHAT.ADMIN.registerClientMethods()}function i(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("hub.start.fail: Could not Connect!");CDF54.JA.SIGNALR.CHAT.MISC.FillState("hub.start.fail: Could not Connect!")}return{ChatHubProxy:null,UserName:null,ConnectionId:null,ChatOrChatAdmin:n(),StartDone:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("hub.start.done: Connected, connection ID= {0}",$.connection.hub.id));CDF54.JA.SIGNALR.CHAT.APP.RegisterEvents();CDF54.JA.SIGNALR.CHAT.MISC.ShowHub();CDF54.JA.SIGNALR.CHAT.MISC.FillState(CDF54.JA.UTILS.StringFormat("Connected, connection ID={0} with Transport = <strong>{1}<\/strong>",$.connection.hub.id,$.connection.hub.transport.name))},RegisterEvents:function(){aliasPUBLIC.registerEvents();aliasPRIVATE.registerEvents()},Init:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Init");$.connection.hub.logging=JSON.parse(String(IsConsoleLoggingEnable()).toLowerCase());this.ChatHubProxy=$.connection.chatHub;t();CDF54.JA.SIGNALR.CHAT.MISC.LoadHtml5NewUserAudioTag();CDF54.JA.SIGNALR.CHAT.MISC.LoadHtml5AudioTag();this.ChatOrChatAdmin=="Chat"&&(CDF54.JA.SIGNALR.CHAT.MISC.showAppPath("spanAppPath"),CDF54.JA.SIGNALR.CHAT.MISC.showAppVersion("spanJsVersion"));this.ChatOrChatAdmin=="ChatAdmin"&&($("#spanCompany").append(CDF54.company.name),$("#spanAddress").append(CDF54.company.address),$("#spanDepartment").append(CDF54.company.departement),$("#spanIsTraceEnable").append(IsTraceEnable()),$("#spanIsDemo").append(IsDemo()),$("#spanIsConsoleLoggingEnable").append(IsConsoleLoggingEnable()),$("#spanAppPath").append(AppPath()),$("#spanChat").append(CDF54.JA.UTILS.StringFormat("Author = {0} Version = {1}",CDF54.JA.SIGNALR.CHAT.author,CDF54.JA.SIGNALR.CHAT.version)),$("#spanUtils").append(CDF54.JA.UTILS.StringFormat("Author = {0} Version = {1}",CDF54.JA.UTILS.author,CDF54.JA.UTILS.version)),CDF54.JA.SIGNALR.CHAT.HELPERS.showJqueryVersion("spanJqueryVersion"),CDF54.JA.SIGNALR.CHAT.HELPERS.showBootstrapVersion("spanBootStrapVersion"),CDF54.JA.SIGNALR.CHAT.HELPERS.showSignalRVersion("spanSignalRVersion"))},Start:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Calling hub.start()");JSON.parse(String(IsDemo()).toLowerCase())?DemoTransports():$.connection.hub.start().done(function(){CDF54.JA.SIGNALR.CHAT.APP.StartDone()}).fail(function(){i()})}}}();CDF54.JA.SIGNALR.CHAT.MISC=function(){"use strict";return{registerClientMethods:function(){this.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MISC function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showServerTrace=function(n){var t={text:Date(),value:n};$("#new-divmessval-template").tmpl(t).appendTo($("#divServerTrace"))};CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.fillState=CDF54.JA.SIGNALR.CHAT.MISC.FillState;CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showServerContext=function(n){if(JSON.parse(String(IsTraceEnable()).toLowerCase())){var t=[{text:"[Context.ConnectionId]",value:n.ConnectionId},{text:"[Context.User.Identity.Name]",value:n.Name},{text:'[Context.QueryString["Transport"]',value:n.Transport},];$("#new-divmessval-template").tmpl(t).appendTo($("#divContext"))}}},showAppPath:function(n){$("#"+n).append(AppPath())},showAppVersion:function(n){$("#"+n).append(CDF54.JA.SIGNALR.CHAT.version)},ToggleVisibilty:function(){$("#inputPrivateMessage").fadeToggle("slow")},ShowHub:function(){var n=$.connection.hub,t,i;JSON.parse(String(IsTraceEnable()).toLowerCase())&&(t=[{text:"[hub.id]",value:n.id},{text:"[hub.transport.name]",value:n.transport.name},{text:"[hub.protocol]",value:n.protocol},{text:"[hub.host]",value:n.host},{text:"[hub.appRelativeUrl]",value:n.appRelativeUrl},],$("#new-divmessval-template").tmpl(t).appendTo($("#divHub")),n.transport.name=="webSockets"&&$("#new-divmessval-template").tmpl({text:"[hub.socket.url] ",value:n.socket.url}).appendTo($("#divHub")),$("#new-divmessval-template").tmpl({text:"=========================================================================================",value:""}).appendTo($("#divHub")),i=[{text:"[navigator.appName]",value:navigator.appName},{text:"[navigator.product]",value:navigator.product},{text:"[navigator.userAgent]",value:navigator.userAgent},],$("#new-divmessval-template").tmpl(i).appendTo($("#divHub")))},ShowClientTrace:function(n){$("#new-divmessval-template").tmpl({text:Date(),value:n}).appendTo($("#divClientTrace"))},FillState:function(n){$("#spanState").html("");$("#spanState").append(n)},MyTrace:function(n){JSON.parse(String(IsTraceEnable()).toLowerCase())&&(console.log(n),this.ShowClientTrace(n))},LoadHtml5NewUserAudioTag:function(){var t=AppPath(),n={id:"newUserAudio",appPath:AppPath(),filename:"Spittoon"};$("#new-audio-template").tmpl(n).appendTo($("body"))},LoadHtml5AudioTag:function(){var t=AppPath(),n={id:"chatAudio",appPath:AppPath(),filename:"notify"};$("#new-audio-template").tmpl(n).appendTo($("body"))}}}();CDF54.JA.SIGNALR.CHAT.USER=function(){"use strict";return{registerClientMethods:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.USER function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showOnlineUsers=function(n){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling showOnlineUsers: count={0} ",n));$("#spanUsersCount").text(n)};CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.onConnected=function(n,t,i,r){var u;for(CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling CHAT_APP.ChatHubProxy.client.onConnected: id={0} username={1}",n.ConnectionId,n.UserName)),CDF54.JA.SIGNALR.CHAT.ConnectionId=n.ConnectionId,CDF54.JA.SIGNALR.CHAT.UserName=n.UserName,CDF54.JA.SIGNALR.CHAT.APP.ChatOrChatAdmin=="Chat"&&(document.getElementById("spanUser")!=null&&$("#spanUser").html(n.UserName),document.getElementById("spanDateConnection")!=null&&$("#spanDateConnection").html(n.ConnectionDateTime),document.getElementById("spanTransport")!=null&&$("#spanTransport").html($.connection.hub.transport.name)),CDF54.JA.SIGNALR.CHAT.APP.ChatOrChatAdmin=="ChatAdmin"&&(document.getElementById("spanUserName")!=null&&$("#spanUserName").html(n.UserName),document.getElementById("spanIdConnection")!=null&&$("#spanIdConnection").html(n.ConnectionId),document.getElementById("spanTransport")!=null&&$("#spanTransport").html($.connection.hub.transport.name),document.getElementById("spanProtocol")!=null&&$("#spanProtocol").html($.connection.hub.protocol)),u=0;u<t.length;u++)CDF54.JA.SIGNALR.CHAT.USER.AddUser(t[u]);for(u=0,u=0;u<i.length;u++)CDF54.JA.SIGNALR.CHAT.MESSAGE.AddMessage(i[u],"PUBLIC","");for(u=0,u=0;u<r.length;u++)CDF54.JA.SIGNALR.CHAT.MESSAGE.AddContentMessage(r[u])};CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.onNewUserConnected=function(n){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Server calling CHAT_APP.ChatHubProxy.client.onNewUserConnected");document.getElementById("newUserAudio")!=null&&$("#newUserAudio")[0].play();CDF54.JA.SIGNALR.CHAT.USER.AddUser(n)};CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.onUserDisconnected=function(n){if(CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.client.onUserDisconnected({0}, {1})",n.ConnectionId,n.UserName)),$("#"+n.ConnectionId).length>0){$("#"+n.ConnectionId).remove();var t=$('<div class="disconnect">"'+n.UserName+'" logged off.<\/div>');$(t).hide();$("#divusers").prepend(t);$(t).fadeIn(200).delay(2e3).fadeOut(200);$("#Private_Input_"+n.ConnectionId).length>0&&$("#Private_Input_"+n.ConnectionId).find("#btnClosePrivate_"+n.ConnectionId).click()}}},AddUser:function(n){var r=CDF54.JA.SIGNALR.CHAT.ConnectionId,i="",t={connectionId:"",theClass:"alert alert-success",theStyle:"",theTitle:n.UserName,name:n.UserName,imagePath:n.PhotoUrl},u;r==n.ConnectionId?i=$("#new-adduser-template").tmpl(t):(t.connectionId=n.ConnectionId,t.theClass="alert alert-info",CDF54.JA.SIGNALR.CHAT.APP.ChatOrChatAdmin=="Chat"&&(t.theStyle="cursor: pointer",t.theTitle="Double click for private talk",t.imagePath=n.PhotoUrl),i=$("#new-adduser-template").tmpl(t),$(i).dblclick(function(){var t=$(this).attr("id");r!=t&&CDF54.JA.SIGNALR.CHAT.MESSAGE.PRIVATE.OpenPrivateChatPanel(t,n.UserName)}));$("#divusers").append(i);u=$("#panelUsers")[0].scrollHeight;$("#panelUsers").scrollTop(u)}}}();CDF54.JA.SIGNALR.CHAT.MESSAGE=function(){"use strict";return{registerClientMethods:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MESSAGE function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showContentMessageReceived=function(n){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.client.showContentMessageReceived({0}, {1}, {2})",n.UserName,n.MessageDateTime,n.Message));CDF54.JA.SIGNALR.CHAT.MESSAGE.AddContentMessage(n)}},AddContentMessage:function(n){var t=$("#"+n.Id).append(n.Message)},AddMessage:function(n,t,i){var f=n.Message,r={Id:n.Id,MessageDateTime:n.MessageDateTime,UserName:n.UserName,encodedMessage:f,myClass:"",imagePath:n.PhotoUrl},u;switch(t){case"PUBLIC":document.getElementById("divChatMessages")!=null&&(n.UserName==CDF54.JA.SIGNALR.CHAT.UserName?(r.myClass="alert alert-success",$("#new-pmessage-template").tmpl(r).appendTo($("#divChatMessages")),$(".alert").emoticonize()):(r.myClass="alert alert-info",$("#new-pmessage-template").tmpl(r).appendTo($("#divChatMessages")),$(".alert").emoticonize()),u=$("#divChatMessages")[0].scrollHeight,$("#divChatMessages").scrollTop(u),CDF54.JA.UTILS.beep());break;case"PRIVATE":$("#Private_List_Panel_"+i).is(":visible")||$("#Private_List_Panel_"+i).toggle();n.UserName==CDF54.JA.SIGNALR.CHAT.UserName?(r.myClass="alert alert-success",$("#new-pmessage-template").tmpl(r).appendTo($("#Private_List_"+i)),$(".alert").emoticonize()):(r.myClass="alert alert-info",$("#new-pmessage-template").tmpl(r).appendTo($("#Private_List_"+i)),$(".alert").emoticonize());u=$("#Private_List_Panel_"+i)[0].scrollHeight;$("#Private_List_Panel_"+i).scrollTop(u);$("#chatAudio")[0].play()}}}}();CDF54.JA.SIGNALR.CHAT.MESSAGE.PUBLIC=function(){"use strict";return{registerEvents:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MESSAGE.PUBLIC function registerEvents");$("#btnSendMsg").click(function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("btnSendMsg");var n=$("#txtMessage").val();n.length>0&&(CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.server.sendMessageToAll(n),CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Client calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.server.sendMessageToAll({0})",n)),$("#txtMessage").val(""))});$("#txtMessage").keypress(function(n){n.which==13&&$("#btnSendMsg").click()})},registerClientMethods:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MESSAGE.PUBLIC function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showMessageReceived=function(n){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.client.showMessageReceived({0}, {1}, {2})",n.UserName,n.MessageDateTime,n.Message));CDF54.JA.SIGNALR.CHAT.MESSAGE.AddMessage(n,"PUBLIC","")}}}}();CDF54.JA.SIGNALR.CHAT.MESSAGE.PRIVATE=function(){"use strict";var n=0,t=function(t,r){n==0&&CDF54.JA.SIGNALR.CHAT.MISC.ToggleVisibilty();n++;var f=$("#new-private-template").tmpl({id:t,name:r}),u=$(f);u.find("#btnSendMessage_"+t).click(function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("btnSendMessage");var i=u.find("#txtPrivateMessage_"+t),n=i.val();n.length>0&&(CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.server.sendPrivateMessage(t,n),CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Client calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.server.sendPrivateMessage({0}, {1})",t,n)),$("#txtPrivateMessage_"+t).val(""))});u.find("#btnClosePrivate_"+t).click(function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("btnClosePrivate");var i="Private_Input_"+t,r="Private_List_"+t,u="Private_List_Panel_"+t;$("#"+i).remove();$("#"+r).remove();$("#"+u).remove();n--;n==0&&CDF54.JA.SIGNALR.CHAT.MISC.ToggleVisibilty()});u.find("#txtPrivateMessage_"+t).keypress(function(n){n.which==13&&$("#btnSendMessage_"+t).click()});i(u)},i=function(n){$("#inputPrivateMessage").append(n)};return{registerEvents:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MESSAGE.PRIVATE function registerEvents")},registerClientMethods:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MESSAGE.PRIVATE function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showPrivateMessage=function(n,i){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.client.showPrivateMessage({0}, {1}, {2})",n.ConnectionId,i.UserName,i.Message));$("#Private_Input_"+n.ConnectionId).is(":visible")||t(n.ConnectionId,i.UserName);CDF54.JA.SIGNALR.CHAT.MESSAGE.AddMessage(i,"PRIVATE",n.ConnectionId)}},OpenPrivateChatPanel:function(n,i){var r="Private_Input_"+n;$("#"+r).length>0||t(n,i)}}}();CDF54.JA.SIGNALR.CHAT.ADMIN=function(){"use strict";return{registerClientMethods:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.ADMIN function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showAdminTable=function(n){if(CDF54.JA.SIGNALR.CHAT.APP.ChatOrChatAdmin=="ChatAdmin"&&document.getElementById("adminTbodyTable")!=null){$("#adminTbodyTable").html("");for(var t=0;t<n.length;t++)$("#new-admintable-template").tmpl({id:n[t].ConnectionId,name:n[t].UserName,connectionDateTime:n[t].ConnectionDateTime,message:n[t].Message,messageDateTime:n[t].MessageDateTime}).appendTo($("#adminTbodyTable")),CDF54.JA.UTILS.beep()}}}}}();var aliasPUBLIC=CDF54.JA.SIGNALR.CHAT.MESSAGE.PUBLIC,aliasPRIVATE=CDF54.JA.SIGNALR.CHAT.MESSAGE.PRIVATE;
//# sourceMappingURL=cdf54.ja.signalR.chat.min.js.map
