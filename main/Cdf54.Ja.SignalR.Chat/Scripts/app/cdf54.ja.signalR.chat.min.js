$(function(){CDF54.JA.SIGNALR.CHAT.APP.Init();CDF54.JA.SIGNALR.CHAT.APP.Start()});CDF54.JA.SIGNALR.CHAT.APP=function(){"use strict";function n(){var t=window.location.pathname,n=window.location.pathname.split("/");return n[n.length-1]}function t(){CDF54.JA.SIGNALR.CHAT.MISC.registerClientMethods();CDF54.JA.SIGNALR.CHAT.USER.registerClientMethods();CDF54.JA.SIGNALR.CHAT.MESSAGE.registerClientMethods();aliasPRIVATE.registerClientMethods();aliasPUBLIC.registerClientMethods();CDF54.JA.SIGNALR.CHAT.ADMIN.registerClientMethods()}function i(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("hub.start.fail: Could not Connect!");CDF54.JA.SIGNALR.CHAT.MISC.FillState("hub.start.fail: Could not Connect!")}return{ChatHubProxy:null,UserName:null,ConnectionId:null,ChatOrChatAdmin:n(),StartDone:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("hub.start.done: Connected, connection ID= {0}",$.connection.hub.id));CDF54.JA.SIGNALR.CHAT.APP.RegisterEvents();CDF54.JA.SIGNALR.CHAT.MISC.ShowHub();CDF54.JA.SIGNALR.CHAT.MISC.FillState("Connected, connection ID="+$.connection.hub.id+" with Transport = <strong>"+$.connection.hub.transport.name+"<\/strong>")},RegisterEvents:function(){aliasPUBLIC.registerEvents();aliasPRIVATE.registerEvents()},Init:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Init");$.connection.hub.logging=JSON.parse(String(IsConsoleLoggingEnable()).toLowerCase());this.ChatHubProxy=$.connection.chatHub;t();CDF54.JA.SIGNALR.CHAT.MISC.LoadHtml5NewUserAudioTag();CDF54.JA.SIGNALR.CHAT.MISC.LoadHtml5AudioTag();this.ChatOrChatAdmin=="Chat"&&(CDF54.JA.SIGNALR.CHAT.MISC.showAppPath("spanAppPath"),CDF54.JA.SIGNALR.CHAT.MISC.showAppVersion("spanJsVersion"));this.ChatOrChatAdmin=="ChatAdmin"&&($("#spanCompany").append(CDF54.company.name),$("#spanAddress").append(CDF54.company.address),$("#spanDepartment").append(CDF54.company.departement),$("#spanIsTraceEnable").append(IsTraceEnable()),$("#spanIsDemo").append(IsDemo()),$("#spanIsConsoleLoggingEnable").append(IsConsoleLoggingEnable()),$("#spanAppPath").append(AppPath()),$("#spanChat").append(CDF54.JA.UTILS.StringFormat("Author = {0} Version = {1}",CDF54.JA.SIGNALR.CHAT.author,CDF54.JA.SIGNALR.CHAT.version)),$("#spanUtils").append(CDF54.JA.UTILS.StringFormat("Author = {0} Version = {1}",CDF54.JA.UTILS.author,CDF54.JA.UTILS.version)),CDF54.JA.SIGNALR.CHAT.HELPERS.showJqueryVersion("spanJqueryVersion"),CDF54.JA.SIGNALR.CHAT.HELPERS.showBootstrapVersion("spanBootStrapVersion"),CDF54.JA.SIGNALR.CHAT.HELPERS.showSignalRVersion("spanSignalRVersion"))},Start:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Calling hub.start()");JSON.parse(String(IsDemo()).toLowerCase())?DemoTransports():$.connection.hub.start().done(function(){CDF54.JA.SIGNALR.CHAT.APP.StartDone()}).fail(function(){i()})}}}();CDF54.JA.SIGNALR.CHAT.MISC=function(){"use strict";return{registerClientMethods:function(){this.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MISC function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showServerTrace=function(n){$("#divServerTrace").append('<div class="message"><span>['+Date()+"] <\/span> : "+n+"<\/div>")};CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.fillState=CDF54.JA.SIGNALR.CHAT.MISC.FillState;CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showServerContext=function(n){JSON.parse(String(IsTraceEnable()).toLowerCase())&&($("#divContext").append('<div class="message"><span>[Context.ConnectionId] <\/span> : '+n.ConnectionId+"<\/div>"),$("#divContext").append('<div class="message"><span>[Context.User.Identity.Name] <\/span> : '+n.Name+"<\/div>"),$("#divContext").append('<div class="message"><span>[Context.QueryString["Transport"]] <\/span> : <strong>'+n.Transport+"<\/strong><\/div>"),$("#divContext").append('<div class="message"><span>[Context.QueryString["ConnectionData"]] <\/span> : '+n.ConnectionData+"<\/div>"))}},showAppPath:function(n){$("#"+n).append(AppPath())},showAppVersion:function(n){$("#"+n).append(CDF54.JA.SIGNALR.CHAT.version)},ToggleVisibilty:function(){$("#inputPrivateMessage").fadeToggle("slow")},ShowHub:function(){var n=$.connection.hub;JSON.parse(String(IsTraceEnable()).toLowerCase())&&($("#divHub").append('<div class="message"><span>[id] <\/span> : '+n.id+"<\/div>"),$("#divHub").append('<div class="message"><span>[transport.name] <\/span> : '+n.transport.name+"<\/div>"),$("#divHub").append('<div class="message"><span>[protocol] <\/span> : '+n.protocol+"<\/div>"),$("#divHub").append('<div class="message"><span>[host] <\/span> : '+n.host+"<\/div>"),$("#divHub").append('<div class="message"><span>[appRelativeUrl] <\/span> : '+n.appRelativeUrl+"<\/div>"),n.transport.name=="webSockets"&&$("#divHub").append('<div class="message"><span>[socket.url] <\/span> : '+n.socket.url+"<\/div>"),$("#divHub").append('<div class="message"><span>========================================================================================= <\/span> : <\/div>'),$("#divHub").append('<div class="message"><span>[navigator.appName] <\/span> : '+navigator.appName+"<\/div>"),$("#divHub").append('<div class="message"><span>[navigator.product] <\/span> : '+navigator.appName+"<\/div>"),$("#divHub").append('<div class="message"><span>[navigator.userAgent] <\/span> : '+navigator.userAgent+"<\/div>"))},ShowClientTrace:function(n){$("#divClientTrace").append('<div class="message"><span>['+Date()+"] <\/span> : "+n+"<\/div>")},FillState:function(n){$("#spanState").html("");$("#spanState").append(n)},MyTrace:function(n){JSON.parse(String(IsTraceEnable()).toLowerCase())&&(console.log(n),this.ShowClientTrace(n))},LoadHtml5NewUserAudioTag:function(){var n=AppPath(),t='<audio id="newUserAudio"><source src="'+n+'/Content/app/Spittoon.mp3" type="audio/mp3">';$(t).appendTo("body")},LoadHtml5AudioTag:function(){var n=AppPath(),t='<audio id="chatAudio"><source src="'+n+'/Content/app/notify.ogg" type="audio/ogg"><source src="'+n+'/Content/app/notify.mp3" type="audio/mp3"><source src="'+n+'/Content/app/notify.wav" type="audio/wav">';$(t).appendTo("body")}}}();CDF54.JA.SIGNALR.CHAT.USER=function(){"use strict";return{registerClientMethods:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.USER function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showOnlineUsers=function(n){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling showOnlineUsers: count={0} ",n));$("#spanUsersCount").text(n)};CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.onConnected=function(n,t,i,r){var u;for(CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling CHAT_APP.ChatHubProxy.client.onConnected: id={0} username={1}",n.ConnectionId,n.UserName)),CDF54.JA.SIGNALR.CHAT.ConnectionId=n.ConnectionId,CDF54.JA.SIGNALR.CHAT.UserName=n.UserName,CDF54.JA.SIGNALR.CHAT.APP.ChatOrChatAdmin=="Chat"&&(document.getElementById("spanUser")!=null&&$("#spanUser").html(n.UserName),document.getElementById("spanDateConnection")!=null&&$("#spanDateConnection").html(n.ConnectionDateTime),document.getElementById("spanTransport")!=null&&$("#spanTransport").html($.connection.hub.transport.name)),CDF54.JA.SIGNALR.CHAT.APP.ChatOrChatAdmin=="ChatAdmin"&&(document.getElementById("spanUserName")!=null&&$("#spanUserName").html(n.UserName),document.getElementById("spanIdConnection")!=null&&$("#spanIdConnection").html(n.ConnectionId),document.getElementById("spanTransport")!=null&&$("#spanTransport").html($.connection.hub.transport.name),document.getElementById("spanProtocol")!=null&&$("#spanProtocol").html($.connection.hub.protocol)),u=0;u<t.length;u++)CDF54.JA.SIGNALR.CHAT.USER.AddUser(t[u]);for(u=0,u=0;u<i.length;u++)CDF54.JA.SIGNALR.CHAT.MESSAGE.AddMessage(i[u],"PUBLIC","");for(u=0,u=0;u<r.length;u++)CDF54.JA.SIGNALR.CHAT.MESSAGE.AddContentMessage(r[u])};CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.onNewUserConnected=function(n){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Server calling CHAT_APP.ChatHubProxy.client.onNewUserConnected");document.getElementById("newUserAudio")!=null&&$("#newUserAudio")[0].play();CDF54.JA.SIGNALR.CHAT.USER.AddUser(n)};CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.onUserDisconnected=function(n){if(CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.client.onUserDisconnected({0}, {1})",n.ConnectionId,n.UserName)),$("#"+n.ConnectionId).length>0){$("#"+n.ConnectionId).remove();var t=$('<div class="disconnect">"'+n.UserName+'" logged off.<\/div>');$(t).hide();$("#divusers").prepend(t);$(t).fadeIn(200).delay(2e3).fadeOut(200);$("#Private_Input_"+n.ConnectionId).length>0&&$("#Private_Input_"+n.ConnectionId).find("#btnClosePrivate").click()}}},AddUser:function(n){var i=CDF54.JA.SIGNALR.CHAT.ConnectionId,t="",r;i==n.ConnectionId?t=$('<p class="alert alert-success"><img src="http://www.gravatar.com/avatar/${hash}?s=16&d=mm" class="gravatar" /> '+n.UserName+"<\/p>"):(t=$('<p id="'+n.ConnectionId+'" class="alert alert-info" style="cursor: pointer" title="Double click for private talk"><img src="http://www.gravatar.com/avatar/${hash}?s=16&d=mm" class="gravatar" /> '+n.UserName+"<\/p>"),$(t).dblclick(function(){var t=$(this).attr("id");i!=t&&CDF54.JA.SIGNALR.CHAT.MESSAGE.PRIVATE.OpenPrivateChatPanel(t,n.UserName)}));$("#divusers").append(t);r=$("#panelUsers")[0].scrollHeight;$("#panelUsers").scrollTop(r)}}}();CDF54.JA.SIGNALR.CHAT.MESSAGE=function(){"use strict";return{registerClientMethods:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MESSAGE function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showContentMessageReceived=function(n){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.client.showContentMessageReceived({0}, {1}, {2})",n.UserName,n.MessageDateTime,n.Message));CDF54.JA.SIGNALR.CHAT.MESSAGE.AddContentMessage(n)}},AddContentMessage:function(n){var t=$("#"+n.Id).append(n.Message)},AddMessage:function(n,t,i){var r=n.Message,u;switch(t){case"PUBLIC":document.getElementById("divChatMessages")!=null&&(n.UserName==CDF54.JA.SIGNALR.CHAT.UserName?$("#divChatMessages").append("<p id="+n.Id+' class="text-success"><strong>['+n.MessageDateTime+"] "+n.UserName+" : <\/strong><i>"+r+"<\/i><\/p>"):$("#divChatMessages").append("<p id="+n.Id+' class="text-info"><strong>['+n.MessageDateTime+"] "+n.UserName+" : <\/strong><i>"+r+"<\/i><\/p>"),u=$("#panelChatMessages")[0].scrollHeight,$("#panelChatMessages").scrollTop(u),CDF54.JA.UTILS.beep());break;case"PRIVATE":if($("#Private_List_Panel_"+i).is(":visible")||$("#Private_List_Panel_"+i).toggle(),document.getElementById("divChatMessages")!=null){n.UserName==CDF54.JA.SIGNALR.CHAT.UserName?$("#Private_List_"+i).append("<p id="+n.Id+' class="text-success"><strong>['+n.MessageDateTime+"] "+n.UserName+" : <\/strong><i>"+r+"<\/i><\/p>"):$("#Private_List_"+i).append("<p id="+n.Id+' class="text-info"><strong>['+n.MessageDateTime+"] "+n.UserName+" : <\/strong><i>"+r+"<\/i><\/p>");u=$("#Private_List_Panel_"+i)[0].scrollHeight;$("#Private_List_Panel_"+i).scrollTop(u);$("#chatAudio")[0].play();break}}}}}();CDF54.JA.SIGNALR.CHAT.MESSAGE.PUBLIC=function(){"use strict";return{registerEvents:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MESSAGE.PUBLIC function registerEvents");$("#btnSendMsg").click(function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("btnSendMsg");var n=$("#txtMessage").val();n.length>0&&(CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.server.sendMessageToAll(n),CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Client calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.server.sendMessageToAll({0})",n)),$("#txtMessage").val(""))});$("#txtMessage").keypress(function(n){n.which==13&&$("#btnSendMsg").click()})},registerClientMethods:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MESSAGE.PUBLIC function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showMessageReceived=function(n){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.client.showMessageReceived({0}, {1}, {2})",n.UserName,n.MessageDateTime,n.Message));CDF54.JA.SIGNALR.CHAT.MESSAGE.AddMessage(n,"PUBLIC","")}}}}();CDF54.JA.SIGNALR.CHAT.MESSAGE.PRIVATE=function(){"use strict";var n=0,t=function(t,r){n==0&&CDF54.JA.SIGNALR.CHAT.MISC.ToggleVisibilty();n++;var f='<div class="input-group" id=Private_Input_'+t+'><span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-pencil"><\/span>&nbsp;To&nbsp;<strong><span>'+r+'><\/span><\/strong><\/span><input type="text" class="form-control input-sm" placeholder="Your message here..." id="txtPrivateMessage" /><div class="input-group-btn"><div class="btn-group btn-group-xs" role="group"><button class="btn btn-warning" type="button" id="btnSendMessage" value="Send">Send private<\/button><\/div><div class="btn-group btn-group-xs"  role="group"><button class="btn btn-danger" type="button" id="btnClosePrivate" value="Send">Close private<\/button><\/div><\/div><\/div><div class="panel panel-default panelScrollDown1 divHide" id=Private_List_Panel_'+t+"><div id=Private_List_"+t+"><\/div><\/div>",u=$(f);u.find("#btnSendMessage").click(function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("btnSendMessage");var i=u.find("#txtPrivateMessage"),n=i.val();n.length>0&&(CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.server.sendPrivateMessage(t,n),CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Client calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.server.sendPrivateMessage({0}, {1})",t,n)),$("#txtPrivateMessage").val(""))});u.find("#btnClosePrivate").click(function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("btnClosePrivate");var i="Private_Input_"+t,r="Private_List_"+t,u="Private_List_Panel_"+t;$("#"+i).remove();$("#"+r).remove();$("#"+u).remove();n--;n==0&&CDF54.JA.SIGNALR.CHAT.MISC.ToggleVisibilty()});u.find("#txtPrivateMessage").keypress(function(n){n.which==13&&$("#btnSendMessage").click()});i(u)},i=function(n){$("#inputPrivateMessage").append(n)};return{registerEvents:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MESSAGE.PRIVATE function registerEvents")},registerClientMethods:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.MESSAGE.PRIVATE function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showPrivateMessage=function(n,i){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace(CDF54.JA.UTILS.StringFormat("Server calling CDF54.JA.SIGNALR.CHAT.ChatHubProxy.client.showPrivateMessage({0}, {1}, {2})",n.ConnectionId,i.UserName,i.Message));$("#Private_Input_"+n.ConnectionId).is(":visible")||t(n.ConnectionId,i.UserName);CDF54.JA.SIGNALR.CHAT.MESSAGE.AddMessage(i,"PRIVATE",n.ConnectionId)}},OpenPrivateChatPanel:function(n,i){var r="Private_Input_"+n;$("#"+r).length>0||t(n,i)}}}();CDF54.JA.SIGNALR.CHAT.ADMIN=function(){"use strict";return{registerClientMethods:function(){CDF54.JA.SIGNALR.CHAT.MISC.MyTrace("Entring CDF54.JA.SIGNALR.CHAT.ADMIN function registerClientMethods");CDF54.JA.SIGNALR.CHAT.APP.ChatHubProxy.client.showAdminTable=function(n){if(CDF54.JA.SIGNALR.CHAT.APP.ChatOrChatAdmin=="ChatAdmin"&&document.getElementById("adminTbodyTable")!=null){$("#adminTbodyTable").html("");for(var t=0;t<n.length;t++)$("#adminTbodyTable").append("<tr><td>"+n[t].ConnectionId+"<\/td><td>"+n[t].UserName+"<\/td><td>"+n[t].ConnectionDateTime+"<\/td><td>"+n[t].Message+"<\/td><td>"+n[t].MessageDateTime+"<\/td><\/tr>"),CDF54.JA.UTILS.beep()}}}}}();var aliasPUBLIC=CDF54.JA.SIGNALR.CHAT.MESSAGE.PUBLIC,aliasPRIVATE=CDF54.JA.SIGNALR.CHAT.MESSAGE.PRIVATE;
//# sourceMappingURL=cdf54.ja.signalR.chat.min.js.map
